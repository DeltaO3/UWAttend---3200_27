{% extends "base.html" %}
{% block content %}
<div class="container d-flex justify-content-center align-items-center flex-column mt-5">
    <h2 class="text-center mb-4">Unit configuration</h2>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    {% if category == 'error' %}
    <div class="alert alert-danger alert-dismissable fade show d-flex justify-content-between" role="alert">
        {{ message }}
        <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% else %}
    <div class="alert alert-success alert-dismissable fade show d-flex justify-content-between" role="alert">
        {{ message }}
        <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
    {% endfor %}
    {% endif %}
    {% endwith %}

    <!-- Add Unit Button -->
    <div class="d-flex justify-content-center mb-3">
        <a href="{{ url_for('addunit') }}" class="btn btn-primary">Add Unit</a>
    </div>

    <!-- Export Database Section -->
    <form method="POST" action="{{ url_for('export_data') }}" class="w-100" style="max-width: 500px;">
        <div class="form-group">
            <label for="unitCode">Select Unit:</label>
            <select name="unitCode" id="unitCode" class="form-control">
                <option value="all">All Units</option>
                {% for unit in units %}
                <option value="{{ unit.code }}">{{ unit.name }} ({{ unit.code }})</option>
                {% endfor %}
            </select>
        </div>
        <div class="d-flex justify-content-center mt-3">
            <button type="submit" class="btn btn-primary">Export Database</button>
        </div>
    </form>

    <!-- Display list of units if available -->
    <div class="d-flex justify-content-center">
        <div class="mx-4 mt-3 mx-md-5 container">
            {% if units|length > 0 %}
            <div class="row d-none d-md-flex text-center lead table-heading">
                <span class="col">Unit Code</span>
                <span class="col">Unit Name</span>
                <span class="col">Study Period</span>
                <span class="col">Start Date</span>
                <span class="col">End Date</span>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="d-flex justify-content-center">
        <div class="mx-4 mt-0 mx-md-5 container" id="unitTable">
            {% if units|length > 0 %}
            {% for unit in units %}
            <!-- onlick re-route to updateunit page for this specific unit -->
            <div class="row table-element text-center my-2 py-2"
                onclick="location.href='{{ url_for('updateunit') +'?id='+unit.unit_id }}'">
                <span class="col-md col-6">{{ unit.code }}</span>
                <span class="col-md col-6">{{ unit.name }}</span>
                <span class="col-md d-none d-md-inline">{{ unit.study_period }}</span>
                <span class="col-md d-none d-md-inline">{{ unit.start_date }}</span>
                <span class="col-md d-none d-md-inline">{{ unit.end_date }}</span>
            </div>
            {% else %}
            <h2 class="text-center">No current units</h2>
            {% endfor %}
            {% endif %}
        </div>
    </div>
</div>
<script src="{{ url_for('static', filename='js/unit.js') }}"></script>
{% endblock %}
